<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <title>Questionário Online</title>
  <link href="https://unpkg.com/survey-core/defaultV2.min.css" rel="stylesheet"/>
  <style>
    body { font-family: Arial, sans-serif; margin: 16px; }
    #controls { margin-bottom: 12px; }
    textarea { width:100%; height:160px; font-family: monospace; }
    #surveyContainer { margin-top: 12px; }
  </style>
</head>
<body>
  <h2>Questionário via SurveyJS</h2>
  <p>Cole o JSON do questionário abaixo e teste:</p>
  <div id="controls">
    <textarea id="jsonIn" placeholder='{"title":"Meu questionário","elements":[ ... ]}'></textarea>
    <br/><br/>
    URL do Google Script: <input id="webhook" style="width:60%" placeholder="Cole aqui a URL do Apps Script">
    <button id="loadBtn">Carregar</button>
    <button id="sample">Exemplo JSON</button>
    <p id="msg" style="color:red"></p>
  </div>

  <div id="surveyContainer"></div>

  <script src="https://unpkg.com/survey-core/survey.core.min.js"></script>
  <script src="https://unpkg.com/survey-react-ui/survey.react.min.js"></script>
  <script>
    const exemplo = {
      "title": "Pesquisa de Satisfação",
      "elements": [
        {"type":"text","name":"nome","title":"Seu nome","isRequired":true},
        {"type":"radiogroup","name":"avaliacao","title":"Como você avalia nosso serviço?","choices":["Ótimo","Bom","Regular","Ruim"]},
        {"type":"comment","name":"observacao","title":"Comentários adicionais"}
      ]
    };

    document.getElementById('sample').onclick = () => {
      document.getElementById('jsonIn').value = JSON.stringify(exemplo, null, 2);
    };

    document.getElementById('loadBtn').onclick = () => {
      const texto = document.getElementById('jsonIn').value.trim();
      const webhook = document.getElementById('webhook').value.trim();
      if (!texto) { document.getElementById('msg').innerText = 'Cole o JSON primeiro.'; return; }

      let json;
      try { json = JSON.parse(texto); }
      catch (e) { document.getElementById('msg').innerText = 'Erro no JSON: ' + e.message; return; }

      const survey = new Survey.Core.Model(json);
      survey.onComplete.add((s) => {
        const dados = s.data;
        fetch(webhook, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({questionario: json.title || 'sem_titulo', respostas: dados})
        }).then(r => r.json())
        .then(res => alert('Enviado com sucesso!'))
        .catch(err => alert('Erro ao enviar: ' + err));
      });

      document.getElementById('surveyContainer').innerHTML = '';
      Survey.ReactSurveyModel.SurveyNG.render(survey, document.getElementById('surveyContainer'));
    };
  </script>
</body>
</html>
