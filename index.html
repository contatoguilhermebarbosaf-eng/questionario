<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <title>Questionário Online</title>
  <link href="https://unpkg.com/survey-core/defaultV2.min.css" rel="stylesheet"/>
  <script src="https://unpkg.com/survey-core/survey.core.min.js"></script>
  <script src="https://unpkg.com/survey-knockout-ui/survey-knockout-ui.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea { width: 100%; height: 180px; font-family: monospace; }
    input { width: 60%; padding: 6px; }
    button { margin: 6px; padding: 8px 14px; cursor: pointer; }
    #surveyContainer { margin-top: 24px; }
  </style>
</head>
<body>
  <h2>Questionário via SurveyJS</h2>
  <p>Cole o JSON do questionário abaixo e teste:</p>

  <textarea id="jsonIn" placeholder='{"title":"Meu questionário","elements":[ ... ]}'></textarea><br/>
  URL do Google Script: <input id="webhook" placeholder="Cole aqui a URL do Apps Script">
  <button id="loadBtn">Carregar</button>
  <button id="sample">Exemplo JSON</button>
  <p id="msg" style="color:red"></p>

  <div id="surveyContainer"></div>

  <script>
    const exemplo = {
      "title": "Pesquisa de Satisfação",
      "elements": [
        {"type":"text","name":"nome","title":"Seu nome","isRequired":true},
        {"type":"radiogroup","name":"avaliacao","title":"Como você avalia nosso serviço?","choices":["Ótimo","Bom","Regular","Ruim"]},
        {"type":"comment","name":"observacao","title":"Comentários adicionais"}
      ]
    };

    document.getElementById('sample').onclick = () => {
      document.getElementById('jsonIn').value = JSON.stringify(exemplo, null, 2);
    };

    document.getElementById('loadBtn').onclick = () => {
      const texto = document.getElementById('jsonIn').value.trim();
      const webhook = document.getElementById('webhook').value.trim();
      if (!texto) { document.getElementById('msg').innerText = 'Cole o JSON primeiro.'; return; }

      let json;
      try { json = JSON.parse(texto); }
      catch (e) { document.getElementById('msg').innerText = 'Erro no JSON: ' + e.message; return; }

      const survey = new Survey.Model(json);
      survey.onComplete.add((s) => {
        const dados = s.data;
        if (!webhook) { alert('Faltou a URL do Apps Script!'); return; }
        fetch(webhook, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({questionario: json.title || 'sem_titulo', respostas: dados})
        })
        .then(r => r.json())
        .then(() => alert('Enviado com sucesso!'))
        .catch(err => alert('Erro ao enviar: ' + err));
      });

      document.getElementById('surveyContainer').innerHTML = '';
      SurveyKnockoutUI.Survey.render('surveyContainer', { model: survey });
    };
  </script>
</body>
</html>
